<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mappers/QuoteMapper.xml -->
<mapper namespace="com.org.quoteservice.server.adapter.out.persistence.mapper.QuoteMapper">
  <insert id="upsertDaily">
    INSERT INTO daily_bars (symbol_id, trade_date, open, high, low, close, adj_close, volume, vwap, raw)
    VALUES (#{symbolId}, #{tradeDate}, #{quote.open}, #{quote.high}, #{quote.low}, #{quote.price}, NULL, #{quote.volume}, NULL, CAST(#{rawJson} AS JSON))
    ON DUPLICATE KEY UPDATE open=VALUES(open), high=VALUES(high), low=VALUES(low), close=VALUES(close),
      adj_close=VALUES(adj_close), volume=VALUES(volume), vwap=VALUES(vwap), raw=VALUES(raw);
  </insert>

</mapper>
